version: "3.8"

services:
  fastlio:
    build:
      context: .
      dockerfile: Dockerfile
    image: fastlio_ros2:foxy
    container_name: fastlio_ros2
    network_mode: host
    privileged: true
    ipc: host
    tty: true
    stdin_open: true
    # 启用所有 GPU（需安装 NVIDIA Container Toolkit）
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
    environment:
      - DISPLAY=${DISPLAY}
      - QT_X11_NO_MITSHM=1
      - ROS_DOMAIN_ID=${ROS_DOMAIN_ID:-0}
      - http_proxy
      - https_proxy
    volumes:
      - ./workspace:/home/rosdev/ros2_ws
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
    working_dir: /home/rosdev/ros2_ws
    # 取消注释以下行来映射串口设备（根据实际情况修改）
    # devices:
    #   - /dev/ttyUSB0:/dev/ttyUSB0:rwm
